{"version":3,"sources":["../src/Simulator.ts"],"names":["_lastUrl","SUGGESTED_XCODE_VERSION","Xcode","minimumVersion","EXPO_GO_BUNDLE_IDENTIFIER","INSTALL_WARNING_TIMEOUT","isPlatformSupported","process","platform","ensureXcodeInstalledAsync","promptToOpenAppStoreAsync","message","confirm","Prompts","confirmAsync","initial","Logger","global","info","openAppStore","appStoreId","version","getXcodeVersion","semver","valid","error","lt","_isXcodeCLIInstalled","ensureXcodeCommandLineToolsInstalledAsync","_ensureXcodeCommandLineToolsInstalledAsync","SimControl","isXcrunInstalledAsync","pendingAsync","chalk","bold","TimeoutError","Error","getSimulatorAppIdAsync","result","osascript","execAsync","trim","_isSimulatorInstalled","isSimulatorInstalledAsync","_isSimulatorInstalledAsync","warn","simctlAsync","e","isXDLError","toString","ensureSimulatorOpenAsync","udid","osType","tryAgain","isSimulatorAppRunningAsync","openSimulatorAppAsync","waitForSimulatorAppToStart","getBestSimulatorAsync","bootedDevice","waitForDeviceToBootAsync","simulatorOpenedByApp","isSimulatorBootedAsync","defaultUdid","_getDefaultSimulatorDeviceUDID","simulators","getSelectableSimulatorsAsync","length","defaultSimulator","find","device","getSimulatorsAsync","filter","isAvailable","simulatorDeviceInfo","listAsync","Object","values","devices","reduce","prev","runtime","concat","getBootedSimulatorsAsync","state","defaultDeviceUDID","stdio","waitForActionAsync","action","interval","maxWaitTime","complete","start","Date","now","bootAsync","activateSimulatorWindowAsync","closeSimulatorAppAsync","isExpoClientInstalledOnSimulatorAsync","getContainerPathAsync","waitForExpoClientInstalledOnSimulatorAsync","waitForExpoClientUninstalledOnSimulatorAsync","expoVersionOnSimulatorAsync","localPath","regex","regexMatch","exec","matched","endsWith","substr","doesExpoClientNeedUpdatedAsync","simulator","sdkVersion","versions","Versions","versionsAsync","clientForSdk","getClientForSDK","latestVersionForSdk","iosVersion","installedVersion","_downloadSimulatorAppAsync","url","downloadProgressCallback","iosUrl","filename","path","parse","name","dir","join","simulatorCacheDirectory","fs","pathExists","filesInDir","readdir","removeSync","mkdirpSync","extract","installExpoOnSimulatorAsync","warningTimer","setWarningTimer","clearTimeout","setTimeout","notifications","code","NotificationCode","START_PROGRESS_BAR","progress","TICK_PROGRESS_BAR","STOP_PROGRESS_BAR","START_LOADING","installAsync","STOP_LOADING","uninstallExpoAppFromSimulatorAsync","uninstallAsync","bundleIdentifier","includes","dotExpoHomeDirectory","UserSettings","upgradeExpoAsync","options","installResult","status","underline","openURLAsync","openUrlInSimulatorSafeAsync","isDetached","devClient","projectRoot","exp","skipSDKVersionRequirement","skipNativeLogs","success","msg","BundleIdentifier","configureBundleIdentifierAsync","assertDevClientInstalledAsync","streamLogsAsync","ensureExpoClientInstalledAsync","Analytics","logEvent","hasPromptedToUpgrade","isInstalled","iosClient","sdkVersionString","sdkVersionsAsync","iosClientUrl","iosClientVersion","openProjectAsync","shouldPrompt","scheme","projectUrl","UrlUtils","constructDeepLinkAsync","hostType","promptForSimulatorAsync","SimControlLogs","isStreamingLogs","imageName","getImageNameFromBundleIdentifierAsync","streamLogs","pid","openWebProjectAsync","Webpack","getUrlAsync","sortDefaultDeviceToBeginningAsync","iterations","push","shift","results","promptForDeviceAsync","pauseInteractions","value","type","limit","choices","map","item","isActive","format","text","title","dim","osVersion","suggest","input","RegExp","choice","test","resumeInteractions"],"mappings":"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","sourcesContent":["import { ExpoConfig, getConfig } from '@expo/config';\nimport * as osascript from '@expo/osascript';\nimport spawnAsync from '@expo/spawn-async';\nimport chalk from 'chalk';\nimport { execSync } from 'child_process';\nimport fs from 'fs-extra';\nimport path from 'path';\nimport prompts from 'prompts';\nimport semver from 'semver';\n\nimport {\n  Analytics,\n  BundleIdentifier,\n  delayAsync,\n  downloadAppAsync,\n  learnMore,\n  Logger,\n  NotificationCode,\n  Prompts,\n  SimControl,\n  SimControlLogs,\n  UrlUtils,\n  UserSettings,\n  Versions,\n  Webpack,\n  Xcode,\n} from './internal';\nimport { profileMethod } from './utils/profileMethod';\n\nlet _lastUrl: string | null = null;\n\nconst SUGGESTED_XCODE_VERSION = `${Xcode.minimumVersion}.0`;\nconst EXPO_GO_BUNDLE_IDENTIFIER = 'host.exp.Exponent';\nconst INSTALL_WARNING_TIMEOUT = 60 * 1000;\n\nexport function isPlatformSupported() {\n  return process.platform === 'darwin';\n}\n\n/**\n * Ensure Xcode is installed an recent enough to be used with Expo.\n *\n * @return true when Xcode is installed, false when the process should end.\n */\nexport async function ensureXcodeInstalledAsync(): Promise<boolean> {\n  const promptToOpenAppStoreAsync = async (message: string) => {\n    // This prompt serves no purpose accept informing the user what to do next, we could just open the App Store but it could be confusing if they don't know what's going on.\n    const confirm = await Prompts.confirmAsync({ initial: true, message });\n    if (confirm) {\n      Logger.global.info(`Going to the App Store, re-run Expo when Xcode is finished installing.`);\n      Xcode.openAppStore(Xcode.appStoreId);\n    }\n  };\n\n  const version = profileMethod(Xcode.getXcodeVersion)();\n  if (!version) {\n    // Almost certainly Xcode isn't installed.\n    await promptToOpenAppStoreAsync(\n      `Xcode needs to be installed (don't worry, you won't have to use it), would you like to continue to the App Store?`\n    );\n    return false;\n  }\n\n  if (!semver.valid(version)) {\n    // Not sure why this would happen, if it does we should add a more confident error message.\n    Logger.global.error(`Xcode version is in an unknown format: ${version}`);\n    return false;\n  }\n\n  if (semver.lt(version, SUGGESTED_XCODE_VERSION)) {\n    // Xcode version is too old.\n    await promptToOpenAppStoreAsync(\n      `Xcode (${version}) needs to be updated to at least version ${Xcode.minimumVersion}, would you like to continue to the App Store?`\n    );\n    return false;\n  }\n\n  return true;\n}\n\nlet _isXcodeCLIInstalled: boolean | null = null;\n\nexport async function ensureXcodeCommandLineToolsInstalledAsync(): Promise<boolean> {\n  // NOTE(Bacon): See `isSimulatorInstalledAsync` for more info on why we cache this value.\n  if (_isXcodeCLIInstalled != null) {\n    return _isXcodeCLIInstalled;\n  }\n  const _ensureXcodeCommandLineToolsInstalledAsync = async () => {\n    if (!(await ensureXcodeInstalledAsync())) {\n      // Need Xcode to install the CLI afaict\n      return false;\n    } else if (await SimControl.isXcrunInstalledAsync()) {\n      // Run this second to ensure the Xcode version check is run.\n      return true;\n    }\n\n    async function pendingAsync(): Promise<boolean> {\n      if (await SimControl.isXcrunInstalledAsync()) {\n        return true;\n      } else {\n        await delayAsync(100);\n        return await pendingAsync();\n      }\n    }\n\n    // This prompt serves no purpose accept informing the user what to do next, we could just open the App Store but it could be confusing if they don't know what's going on.\n    const confirm = await Prompts.confirmAsync({\n      initial: true,\n      message: `Xcode ${chalk.bold`Command Line Tools`} needs to be installed (requires ${chalk.bold`sudo`}), continue?`,\n    });\n\n    if (!confirm) {\n      return false;\n    }\n\n    try {\n      await spawnAsync('sudo', [\n        'xcode-select',\n        '--install',\n        // TODO: Is there any harm in skipping this?\n        // '--switch', '/Applications/Xcode.app'\n      ]);\n      // Most likely the user will cancel the process, but if they don't this will continue checking until the CLI is available.\n      await pendingAsync();\n      return true;\n    } catch (error) {\n      // TODO: Figure out why this might get called (cancel early, network issues, server problems)\n      // TODO: Handle me\n    }\n    return false;\n  };\n  _isXcodeCLIInstalled = await _ensureXcodeCommandLineToolsInstalledAsync();\n\n  return _isXcodeCLIInstalled;\n}\n\nclass TimeoutError extends Error {}\n\nasync function getSimulatorAppIdAsync(): Promise<string | null> {\n  let result;\n  try {\n    result = (await osascript.execAsync('id of app \"Simulator\"')).trim();\n  } catch {\n    // This error may occur in CI where the users intends to install just the simulators but no Xcode.\n    return null;\n  }\n  return result;\n}\n\nlet _isSimulatorInstalled: null | boolean = null;\n\n// Simulator installed\nexport async function isSimulatorInstalledAsync(): Promise<boolean> {\n  if (_isSimulatorInstalled != null) {\n    return _isSimulatorInstalled;\n  }\n  // NOTE(Bacon): This method can take upwards of 1-2s to run so we should cache the results per process.\n  // If the user installs Xcode while expo start is running, they'll need to restart\n  // the process for the command to work properly.\n  // This is better than waiting 1-2s every time you want to open the app on iOS.\n  const _isSimulatorInstalledAsync = async () => {\n    // Check to ensure Xcode and its CLI are installed and up to date.\n    if (!(await ensureXcodeCommandLineToolsInstalledAsync())) {\n      return false;\n    }\n    // TODO: extract into ensureSimulatorInstalled method\n\n    const result = await getSimulatorAppIdAsync();\n    if (!result) {\n      // This error may occur in CI where the users intends to install just the simulators but no Xcode.\n      Logger.global.error(\n        \"Can't determine id of Simulator app; the Simulator is most likely not installed on this machine. Run `sudo xcode-select -s /Applications/Xcode.app`\"\n      );\n      return false;\n    }\n    if (\n      result !== 'com.apple.iphonesimulator' &&\n      result !== 'com.apple.CoreSimulator.SimulatorTrampoline'\n    ) {\n      // TODO: FYI\n      Logger.global.warn(\n        \"Simulator is installed but is identified as '\" + result + \"'; don't know what that is.\"\n      );\n      return false;\n    }\n\n    // make sure we can run simctl\n    try {\n      await SimControl.simctlAsync(['help']);\n    } catch (e) {\n      if (e.isXDLError) {\n        Logger.global.error(e.toString());\n      } else {\n        Logger.global.warn(`Unable to run simctl: ${e.toString()}`);\n        Logger.global.error(\n          'xcrun may not be configured correctly. Try running `sudo xcode-select --reset` and running this again.'\n        );\n      }\n      return false;\n    }\n\n    return true;\n  };\n  _isSimulatorInstalled = await _isSimulatorInstalledAsync();\n\n  return _isSimulatorInstalled;\n}\n\n/**\n * Ensure a simulator is booted and the Simulator app is opened.\n * This is where any timeout related error handling should live.\n */\nexport async function ensureSimulatorOpenAsync(\n  { udid, osType }: { udid?: string; osType?: string } = {},\n  tryAgain: boolean = true\n): Promise<SimControl.SimulatorDevice> {\n  // Yes, simulators can be booted even if the app isn't running, obviously we'd never want this.\n  if (!(await SimControl.isSimulatorAppRunningAsync())) {\n    Logger.global.info(`\\u203A Opening the iOS simulator, this might take a moment.`);\n\n    // In theory this would ensure the correct simulator is booted as well.\n    // This isn't theory though, this is Xcode.\n    await SimControl.openSimulatorAppAsync({ udid });\n    if (!(await waitForSimulatorAppToStart())) {\n      throw new TimeoutError(\n        `Simulator app did not open fast enough. Try opening Simulator first, then running your app.`\n      );\n    }\n  }\n\n  // Use a default simulator if none was specified\n  if (!udid) {\n    udid = await getBestSimulatorAsync({ osType });\n  }\n\n  const bootedDevice = await waitForDeviceToBootAsync({ udid });\n\n  if (!bootedDevice) {\n    // Give it a second chance, this might not be needed but it could potentially lead to a better UX on slower devices.\n    if (tryAgain) {\n      return await ensureSimulatorOpenAsync({ udid, osType }, false);\n    }\n    // TODO: We should eliminate all needs for a timeout error, it's bad UX to get an error about the simulator not starting while the user can clearly see it starting on their slow computer.\n    throw new TimeoutError(\n      `Simulator didn't boot fast enough. Try opening Simulator first, then running your app.`\n    );\n  }\n  return bootedDevice;\n}\n\nasync function getBestSimulatorAsync({ osType }: { osType?: string }): Promise<string> {\n  const simulatorOpenedByApp = await isSimulatorBootedAsync();\n\n  // This should prevent opening a second simulator in the chance that default\n  // simulator doesn't match what the Simulator app would open by default.\n  if (\n    simulatorOpenedByApp?.udid &&\n    (!osType || (osType && simulatorOpenedByApp.osType === osType))\n  ) {\n    return simulatorOpenedByApp.udid;\n  }\n\n  const defaultUdid = _getDefaultSimulatorDeviceUDID();\n\n  if (defaultUdid && !osType) {\n    return defaultUdid;\n  }\n\n  const simulators = await getSelectableSimulatorsAsync({ osType });\n\n  if (!simulators.length) {\n    // TODO: Prompt to install the simulators\n    throw new Error(`No ${osType || 'iOS'} devices available in Simulator.app`);\n  }\n\n  // If the default udid is defined, then check to ensure its osType matches the required os.\n  if (defaultUdid) {\n    const defaultSimulator = simulators.find(device => device.udid === defaultUdid);\n    if (defaultSimulator?.osType === osType) {\n      return defaultUdid;\n    }\n  }\n\n  // Return first selectable device.\n  return simulators[0].udid;\n}\n\n/**\n * Get all simulators supported by Expo (iOS only).\n */\nasync function getSelectableSimulatorsAsync({ osType = 'iOS' }: { osType?: string } = {}): Promise<\n  SimControl.SimulatorDevice[]\n> {\n  const simulators = await getSimulatorsAsync();\n  return simulators.filter(device => device.isAvailable && device.osType === osType);\n}\n\nasync function getSimulatorsAsync(): Promise<SimControl.SimulatorDevice[]> {\n  const simulatorDeviceInfo = await SimControl.listAsync('devices');\n  return Object.values(simulatorDeviceInfo.devices).reduce((prev, runtime) => {\n    return prev.concat(runtime);\n  }, []);\n}\n\nasync function getBootedSimulatorsAsync(): Promise<SimControl.SimulatorDevice[]> {\n  const simulators = await getSimulatorsAsync();\n  return simulators.filter(device => device.state === 'Booted');\n}\n\nexport async function isSimulatorBootedAsync({\n  udid,\n}: {\n  udid?: string;\n} = {}): Promise<SimControl.SimulatorDevice | null> {\n  // Simulators can be booted even if the app isn't running :(\n  const devices = await getBootedSimulatorsAsync();\n  if (udid) {\n    return devices.find(bootedDevice => bootedDevice.udid === udid) ?? null;\n  } else {\n    return devices[0] ?? null;\n  }\n}\n\nfunction _getDefaultSimulatorDeviceUDID() {\n  try {\n    const defaultDeviceUDID = execSync(\n      `defaults read com.apple.iphonesimulator CurrentDeviceUDID`,\n      { stdio: 'pipe' }\n    ).toString();\n    return defaultDeviceUDID.trim();\n  } catch (e) {\n    return null;\n  }\n}\n\nasync function waitForActionAsync<T>({\n  action,\n  interval = 100,\n  maxWaitTime = 20000,\n}: {\n  action: () => T | Promise<T>;\n  interval?: number;\n  maxWaitTime?: number;\n}): Promise<T> {\n  let complete: T;\n  const start = Date.now();\n  do {\n    await delayAsync(interval);\n\n    complete = await action();\n    if (Date.now() - start > maxWaitTime) {\n      break;\n    }\n  } while (!complete);\n\n  return complete;\n}\n\nasync function waitForSimulatorAppToStart(): Promise<boolean> {\n  return waitForActionAsync<boolean>({\n    interval: 50,\n    action: SimControl.isSimulatorAppRunningAsync,\n  });\n}\n\nasync function waitForDeviceToBootAsync({\n  udid,\n}: Pick<SimControl.SimulatorDevice, 'udid'>): Promise<SimControl.SimulatorDevice | null> {\n  return waitForActionAsync<SimControl.SimulatorDevice | null>({\n    action: () => {\n      return SimControl.bootAsync({ udid });\n    },\n  });\n}\n\nexport async function activateSimulatorWindowAsync() {\n  // TODO: Focus the individual window\n  return await osascript.execAsync(`tell application \"Simulator\" to activate`);\n}\n\nexport async function closeSimulatorAppAsync() {\n  return await osascript.execAsync('tell application \"Simulator\" to quit');\n}\n\nexport async function isExpoClientInstalledOnSimulatorAsync({\n  udid,\n}: {\n  udid: string;\n}): Promise<boolean> {\n  return !!(await SimControl.getContainerPathAsync(udid, EXPO_GO_BUNDLE_IDENTIFIER));\n}\n\nexport async function waitForExpoClientInstalledOnSimulatorAsync({\n  udid,\n}: {\n  udid: string;\n}): Promise<boolean> {\n  if (await isExpoClientInstalledOnSimulatorAsync({ udid })) {\n    return true;\n  } else {\n    await delayAsync(100);\n    return await waitForExpoClientInstalledOnSimulatorAsync({ udid });\n  }\n}\nexport async function waitForExpoClientUninstalledOnSimulatorAsync({\n  udid,\n}: {\n  udid: string;\n}): Promise<boolean> {\n  if (!(await isExpoClientInstalledOnSimulatorAsync({ udid }))) {\n    return true;\n  } else {\n    await delayAsync(100);\n    return await waitForExpoClientInstalledOnSimulatorAsync({ udid });\n  }\n}\n\nexport async function expoVersionOnSimulatorAsync({\n  udid,\n}: {\n  udid: string;\n}): Promise<string | null> {\n  const localPath = await SimControl.getContainerPathAsync(udid, EXPO_GO_BUNDLE_IDENTIFIER);\n  if (!localPath) {\n    return null;\n  }\n\n  const regex = /Exponent-([0-9.]+).*\\.app$/;\n  const regexMatch = regex.exec(localPath);\n  if (!regexMatch) {\n    return null;\n  }\n\n  let matched = regexMatch[1];\n  // If the value is matched like 1.0.0. then remove the trailing dot.\n  if (matched.endsWith('.')) {\n    matched = matched.substr(0, matched.length - 1);\n  }\n  return matched;\n}\n\nexport async function doesExpoClientNeedUpdatedAsync(\n  simulator: Pick<SimControl.SimulatorDevice, 'udid'>,\n  sdkVersion?: string\n): Promise<boolean> {\n  // Test that upgrading works by returning true\n  // return true;\n  const versions = await Versions.versionsAsync();\n  const clientForSdk = await getClientForSDK(sdkVersion);\n  const latestVersionForSdk = clientForSdk?.version ?? versions.iosVersion;\n\n  const installedVersion = await expoVersionOnSimulatorAsync(simulator);\n  if (installedVersion && semver.lt(installedVersion, latestVersionForSdk)) {\n    return true;\n  }\n  return false;\n}\n\n// If specific URL given just always download it and don't use cache\nexport async function _downloadSimulatorAppAsync(\n  url?: string,\n  downloadProgressCallback?: (roundedProgress: number) => void\n) {\n  if (!url) {\n    const versions = await Versions.versionsAsync();\n    url = versions.iosUrl;\n  }\n\n  const filename = path.parse(url).name;\n  const dir = path.join(simulatorCacheDirectory(), `${filename}.app`);\n\n  if (await fs.pathExists(dir)) {\n    const filesInDir = await fs.readdir(dir);\n    if (filesInDir.length > 0) {\n      return dir;\n    } else {\n      fs.removeSync(dir);\n    }\n  }\n\n  fs.mkdirpSync(dir);\n  try {\n    await downloadAppAsync(url, dir, { extract: true }, downloadProgressCallback);\n  } catch (e) {\n    fs.removeSync(dir);\n    throw e;\n  }\n\n  return dir;\n}\n\n// url: Optional URL of Exponent.app tarball to download\nexport async function installExpoOnSimulatorAsync({\n  url,\n  simulator,\n  version,\n}: {\n  simulator: Pick<SimControl.SimulatorDevice, 'name' | 'udid'>;\n  url?: string;\n  version?: string;\n}) {\n  let warningTimer: NodeJS.Timeout;\n  const setWarningTimer = () => {\n    if (warningTimer) {\n      clearTimeout(warningTimer);\n    }\n    return setTimeout(() => {\n      Logger.global.info('');\n      Logger.global.info(\n        'This download is taking longer than expected. You can also try downloading the clients from the website at https://expo.io/tools'\n      );\n    }, INSTALL_WARNING_TIMEOUT);\n  };\n\n  Logger.notifications.info(\n    { code: NotificationCode.START_PROGRESS_BAR },\n    'Downloading the Expo Go app [:bar] :percent :etas'\n  );\n\n  warningTimer = setWarningTimer();\n\n  const dir = await _downloadSimulatorAppAsync(url, progress => {\n    Logger.notifications.info({ code: NotificationCode.TICK_PROGRESS_BAR }, progress);\n  });\n\n  Logger.notifications.info({ code: NotificationCode.STOP_PROGRESS_BAR });\n\n  const message = version\n    ? `Installing Expo Go ${version} on ${simulator.name}`\n    : `Installing Expo Go on ${simulator.name}`;\n  Logger.notifications.info({ code: NotificationCode.START_LOADING }, message);\n  warningTimer = setWarningTimer();\n\n  const result = await SimControl.installAsync({ udid: simulator.udid, dir });\n  Logger.notifications.info({ code: NotificationCode.STOP_LOADING });\n\n  clearTimeout(warningTimer);\n  return result;\n}\n\nexport async function uninstallExpoAppFromSimulatorAsync({ udid }: { udid?: string } = {}) {\n  try {\n    Logger.global.info('Uninstalling Expo Go from iOS simulator.');\n    await SimControl.uninstallAsync({ udid, bundleIdentifier: EXPO_GO_BUNDLE_IDENTIFIER });\n  } catch (e) {\n    if (!e.message?.includes('No devices are booted.')) {\n      Logger.global.error(e);\n      throw e;\n    }\n  }\n}\n\nfunction simulatorCacheDirectory() {\n  const dotExpoHomeDirectory = UserSettings.dotExpoHomeDirectory();\n  const dir = path.join(dotExpoHomeDirectory, 'ios-simulator-app-cache');\n  fs.mkdirpSync(dir);\n  return dir;\n}\n\nexport async function upgradeExpoAsync(\n  options: {\n    udid?: string;\n    url?: string;\n    version?: string;\n  } = {}\n): Promise<boolean> {\n  if (!(await isSimulatorInstalledAsync())) {\n    return false;\n  }\n\n  const simulator = await ensureSimulatorOpenAsync(options);\n\n  await uninstallExpoAppFromSimulatorAsync(simulator);\n  const installResult = await installExpoOnSimulatorAsync({\n    url: options.url,\n    version: options.version,\n    simulator,\n  });\n  if (installResult.status !== 0) {\n    return false;\n  }\n\n  if (_lastUrl) {\n    Logger.global.info(`\\u203A Opening ${chalk.underline(_lastUrl)} in Expo`);\n    await SimControl.openURLAsync({ udid: simulator.udid, url: _lastUrl });\n    _lastUrl = null;\n  }\n\n  return true;\n}\n\nasync function openUrlInSimulatorSafeAsync({\n  url,\n  udid,\n  isDetached = false,\n  sdkVersion,\n  devClient = false,\n  projectRoot,\n  exp = getConfig(projectRoot, { skipSDKVersionRequirement: true }).exp,\n  skipNativeLogs = false,\n}: {\n  url: string;\n  udid?: string;\n  sdkVersion?: string;\n  isDetached: boolean;\n  devClient?: boolean;\n  exp?: ExpoConfig;\n  projectRoot: string;\n  skipNativeLogs?: boolean;\n}): Promise<\n  | { success: true; device: SimControl.SimulatorDevice; bundleIdentifier: string }\n  | { success: false; msg: string }\n> {\n  let simulator: SimControl.SimulatorDevice | null = null;\n  try {\n    simulator = await profileMethod(ensureSimulatorOpenAsync)({ udid });\n  } catch (error) {\n    return {\n      success: false,\n      msg: error.message,\n    };\n  }\n  Logger.global.info(`\\u203A Opening ${chalk.underline(url)} on ${chalk.bold(simulator.name)}`);\n\n  let bundleIdentifier = EXPO_GO_BUNDLE_IDENTIFIER;\n  try {\n    if (devClient) {\n      bundleIdentifier = await profileMethod(BundleIdentifier.configureBundleIdentifierAsync)(\n        projectRoot,\n        exp\n      );\n      await profileMethod(assertDevClientInstalledAsync)(simulator, bundleIdentifier);\n      if (!skipNativeLogs) {\n        // stream logs before opening the client.\n        await streamLogsAsync({ udid: simulator.udid, bundleIdentifier });\n      }\n    } else if (!isDetached) {\n      await ensureExpoClientInstalledAsync(simulator, sdkVersion);\n      _lastUrl = url;\n    }\n\n    await profileMethod(\n      SimControl.openURLAsync,\n      'SimControl.openURLAsync'\n    )({ url, udid: simulator.udid });\n  } catch (e) {\n    if (e.status === 194) {\n      // An error was encountered processing the command (domain=NSOSStatusErrorDomain, code=-10814):\n      // The operation couldnâ€™t be completed. (OSStatus error -10814.)\n      //\n      // This can be thrown when no app conforms to the URI scheme that we attempted to open.\n\n      return {\n        success: false,\n        msg: `Device ${simulator.name} (${simulator.udid}) has no app to handle the URI: ${url}`,\n      };\n    }\n    if (e.isXDLError) {\n      // Hit some internal error, don't try again.\n      // This includes Xcode license errors\n      Logger.global.error(e.message);\n      return {\n        success: false,\n        msg: `${e.toString()}`,\n      };\n    }\n\n    if (isDetached) {\n      Logger.global.error(\n        `Error running app. Have you installed the app already using Xcode? Since you are detached you must build manually. ${e.toString()}`\n      );\n    } else {\n      Logger.global.error(e.message);\n    }\n\n    return {\n      success: false,\n      msg: `${e.toString()}`,\n    };\n  }\n\n  Analytics.logEvent('Open Url on Device', {\n    platform: 'ios',\n  });\n\n  return {\n    success: true,\n    device: simulator,\n    bundleIdentifier,\n  };\n}\n\nasync function assertDevClientInstalledAsync(\n  simulator: Pick<SimControl.SimulatorDevice, 'udid' | 'name'>,\n  bundleIdentifier: string\n): Promise<void> {\n  if (!(await SimControl.getContainerPathAsync(simulator.udid, bundleIdentifier))) {\n    throw new Error(\n      `The development client (${bundleIdentifier}) for this project is not installed. ` +\n        `Please build and install the client on the simulator first.\\n${learnMore(\n          'https://docs.expo.io/clients/distribution-for-ios/#building-for-ios'\n        )}`\n    );\n  }\n}\n\n// Keep a list of simulator UDIDs so we can prevent asking multiple times if a user wants to upgrade.\n// This can prevent annoying interactions when they don't want to upgrade for whatever reason.\nconst hasPromptedToUpgrade: Record<string, boolean> = {};\n\nasync function ensureExpoClientInstalledAsync(\n  simulator: Pick<SimControl.SimulatorDevice, 'udid' | 'name'>,\n  sdkVersion?: string\n) {\n  let isInstalled = await isExpoClientInstalledOnSimulatorAsync(simulator);\n\n  if (isInstalled && !hasPromptedToUpgrade[simulator.udid]) {\n    // Only prompt/check for updates once per simulator in a single run.\n    hasPromptedToUpgrade[simulator.udid] = true;\n    if (await profileMethod(doesExpoClientNeedUpdatedAsync)(simulator, sdkVersion)) {\n      const confirm = await Prompts.confirmAsync({\n        initial: true,\n        message: `Expo Go on ${simulator.name} is outdated, would you like to upgrade?`,\n      });\n      if (confirm) {\n        // TODO: Is there any downside to skipping the uninstall step?\n        // await uninstallExpoAppFromSimulatorAsync(simulator);\n        // await waitForExpoClientUninstalledOnSimulatorAsync(simulator);\n        isInstalled = false;\n      }\n    }\n  }\n  // If it's still \"not installed\" then install it (again).\n  if (!isInstalled) {\n    const iosClient = await getClientForSDK(sdkVersion);\n    await installExpoOnSimulatorAsync({ simulator, ...iosClient });\n    await waitForExpoClientInstalledOnSimulatorAsync(simulator);\n  }\n}\n\nasync function getClientForSDK(sdkVersionString?: string) {\n  if (!sdkVersionString) {\n    return null;\n  }\n\n  const sdkVersion = (await Versions.sdkVersionsAsync())[sdkVersionString];\n  if (!sdkVersion) {\n    return null;\n  }\n\n  return {\n    url: sdkVersion.iosClientUrl,\n    version: sdkVersion.iosClientVersion,\n  };\n}\n\nexport async function openProjectAsync({\n  projectRoot,\n  shouldPrompt,\n  devClient,\n  udid,\n  scheme,\n  skipNativeLogs,\n}: {\n  projectRoot: string;\n  shouldPrompt?: boolean;\n  devClient?: boolean;\n  scheme?: string;\n  udid?: string;\n  skipNativeLogs?: boolean;\n}): Promise<\n  | { success: true; url: string; udid: string; bundleIdentifier: string }\n  | { success: false; error: string }\n> {\n  if (!(await profileMethod(isSimulatorInstalledAsync)())) {\n    return {\n      success: false,\n      error: 'Unable to verify Xcode and Simulator installation.',\n    };\n  }\n\n  const projectUrl = await UrlUtils.constructDeepLinkAsync(projectRoot, {\n    hostType: 'localhost',\n    scheme,\n  });\n\n  const { exp } = getConfig(projectRoot, {\n    skipSDKVersionRequirement: true,\n  });\n\n  let device: SimControl.SimulatorDevice | null = null;\n  if (udid) {\n    device = await ensureSimulatorOpenAsync({ udid });\n  } else if (shouldPrompt) {\n    const devices = await getSelectableSimulatorsAsync();\n    device = await promptForSimulatorAsync(devices);\n    if (!device) {\n      return { success: false, error: 'escaped' };\n    }\n  }\n\n  const result = await profileMethod(openUrlInSimulatorSafeAsync)({\n    udid: device?.udid,\n    url: projectUrl,\n    sdkVersion: exp.sdkVersion,\n    isDetached: !!exp.isDetached,\n    devClient,\n    exp,\n    projectRoot,\n    skipNativeLogs,\n  });\n\n  if (result.success) {\n    // run out of sync\n    activateSimulatorWindowAsync();\n\n    return {\n      success: true,\n      url: projectUrl,\n      udid: result.device.udid,\n      bundleIdentifier: result.bundleIdentifier,\n    };\n  }\n  return { success: result.success, error: result.msg };\n}\n\nexport async function streamLogsAsync({\n  bundleIdentifier,\n  udid,\n}: {\n  bundleIdentifier: string;\n  udid: string;\n}) {\n  if (SimControlLogs.isStreamingLogs(udid)) {\n    return;\n  }\n\n  const imageName = await SimControlLogs.getImageNameFromBundleIdentifierAsync(\n    udid,\n    bundleIdentifier\n  );\n\n  if (imageName) {\n    // Attach simulator log observer\n    SimControlLogs.streamLogs({ pid: imageName, udid });\n  }\n}\n\nexport async function openWebProjectAsync({\n  projectRoot,\n  shouldPrompt,\n}: {\n  shouldPrompt: boolean;\n  projectRoot: string;\n}): Promise<{ success: true; url: string } | { success: false; error: string }> {\n  if (!(await isSimulatorInstalledAsync())) {\n    return {\n      success: false,\n      error: 'Unable to verify Xcode and Simulator installation.',\n    };\n  }\n\n  const projectUrl = await Webpack.getUrlAsync(projectRoot);\n  if (projectUrl === null) {\n    return {\n      success: false,\n      error: `The web project has not been started yet`,\n    };\n  }\n\n  let device: SimControl.SimulatorDevice | null = null;\n  if (shouldPrompt) {\n    const devices = await getSelectableSimulatorsAsync();\n    device = await promptForSimulatorAsync(devices);\n    if (!device) {\n      return { success: false, error: 'escaped' };\n    }\n  }\n\n  const result = await openUrlInSimulatorSafeAsync({\n    url: projectUrl,\n    udid: device?.udid,\n    isDetached: true,\n    projectRoot,\n  });\n  if (result.success) {\n    // run out of sync\n    activateSimulatorWindowAsync();\n    return { success: true, url: projectUrl };\n  }\n  return { success: result.success, error: result.msg };\n}\n\n/**\n * Sort the devices so the last simulator that was opened (user's default) is the first suggested.\n *\n * @param devices\n */\nexport async function sortDefaultDeviceToBeginningAsync(\n  devices: SimControl.SimulatorDevice[],\n  osType?: string\n): Promise<SimControl.SimulatorDevice[]> {\n  const defaultUdid = await getBestSimulatorAsync({ osType });\n  if (defaultUdid) {\n    let iterations = 0;\n    while (devices[0].udid !== defaultUdid && iterations < devices.length) {\n      devices.push(devices.shift()!);\n      iterations++;\n    }\n  }\n  return devices;\n}\n\nexport async function promptForSimulatorAsync(\n  devices: SimControl.SimulatorDevice[],\n  osType?: string\n): Promise<SimControl.SimulatorDevice | null> {\n  devices = await sortDefaultDeviceToBeginningAsync(devices, osType);\n  // TODO: Bail on non-interactive\n  const results = await promptForDeviceAsync(devices);\n\n  return results ? devices.find(({ udid }) => results === udid)! : null;\n}\n\nasync function promptForDeviceAsync(\n  devices: SimControl.SimulatorDevice[]\n): Promise<string | undefined> {\n  // TODO: provide an option to add or download more simulators\n  // TODO: Add support for physical devices too.\n\n  // Pause interactions on the TerminalUI\n  Prompts.pauseInteractions();\n\n  const { value } = await prompts({\n    type: 'autocomplete',\n    name: 'value',\n    limit: 11,\n    message: 'Select a simulator',\n    choices: devices.map(item => {\n      const isActive = item.state === 'Booted';\n      const format = isActive ? chalk.bold : (text: string) => text;\n      return {\n        title: `${format(item.name)} ${chalk.dim(`(${item.osVersion})`)}`,\n        value: item.udid,\n      };\n    }),\n    suggest: (input: any, choices: any) => {\n      const regex = new RegExp(input, 'i');\n      return choices.filter((choice: any) => regex.test(choice.title));\n    },\n  });\n\n  // Resume interactions on the TerminalUI\n  Prompts.resumeInteractions();\n  return value;\n}\n"],"file":"Simulator.js"}